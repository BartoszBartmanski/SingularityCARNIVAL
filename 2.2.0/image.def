Bootstrap: library
From: bartosz_bartmanski/default/r-base:4.0.3

%files
    ./gen_igraph_input.R /scripts/
    ./run_carnival.R /scripts/
    ./example_config.json /scripts/

%post
    apt -y update

    /usr/local/bin/R --no-echo -e 'install.packages("devtools", repos = "http://cran.us.r-project.org")'
    /usr/local/bin/R --no-echo -e 'devtools::install_github("saezlab/CARNIVAL")'
    /usr/local/bin/R --no-echo -e 'install.packages(c("igraph", "rhdf5", "rjson"), repos = "http://cran.us.r-project.org")'

    mkdir /data/

    echo "Done!"

%environment
    export LC_ALL=C

%runscript
	echo "Running an example"
    /scripts/gen_igraph_input.R 10 8 3 3 Erdos /data/test.h5
    /scripts/run_carnival.R /data/test.h5 /data/result.Rds /scripts/example_config.json

